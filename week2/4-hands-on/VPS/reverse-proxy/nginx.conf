events {}

http {
    resolver 127.0.0.11 ipv6=off;

    server {
        listen 80;

        # ======================================================
        # DEFAULT LANDING PAGE
        # ======================================================
        location = / {
            root /etc/nginx/html;
            index index.html;
        }

        # ======================================================
        # APP 1 â€” Streamlit + FastAPI
        # ======================================================
        set $frontend1 http://frontend1:8080;
        set $backend1  http://backend1:8000;

        location /app1/ {
            rewrite ^/app1/(.*)$ /$1 break;

            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;

            proxy_pass $frontend1;
        }

        location /app1/api/ {
            rewrite ^/app1/api/(.*)$ /$1 break;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;

            proxy_pass $backend1;
        }

        # ======================================================
        # APP 2
        # ======================================================
        set $frontend2 http://frontend2:8080;
        set $backend2  http://backend2:8000;

        location /abraham-app/ {
            rewrite ^/abraham-app/(.*)$ /$1 break;

            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;

            proxy_pass $frontend2;
        }

        location /abraham-app/api/ {
            rewrite ^/abraham-app/api/(.*)$ /$1 break;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;

            proxy_pass $backend2;
        }

        # ======================================================
        # APP 3
        # ======================================================
        set $frontend3 http://frontend3:8080;
        set $backend3  http://backend3:8000;

        location /alpha-oumar-app/ {
            rewrite ^/alpha-oumar-app/(.*)$ /$1 break;

            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;

            proxy_pass $frontend3;
        }

        location /alpha-oumar-app/api/ {
            rewrite ^/alpha-oumar-app/api/(.*)$ /$1 break;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;

            proxy_pass $backend3;
        }

        # ======================================================
        # APP 4
        # ======================================================
        set $frontend4 http://frontend4:8080;
        set $backend4  http://backend4:8000;

        location /anne-josee-app/ {
            rewrite ^/anne-josee-app/(.*)$ /$1 break;

            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;

            proxy_pass $frontend4;
        }

        location /anne-josee-app/api/ {
            rewrite ^/anne-josee-app/api/(.*)$ /$1 break;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;

            proxy_pass $backend4;
        }

        # ======================================================
        # APP 5
        # ======================================================
        set $frontend5 http://frontend5:8080;
        set $backend5  http://backend5:8000;

        location /codjo-ulrich-app/ {
            rewrite ^/codjo-ulrich-app/(.*)$ /$1 break;

            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;

            proxy_pass $frontend5;
        }

        location /codjo-ulrich-app/api/ {
            rewrite ^/codjo-ulrich-app/api/(.*)$ /$1 break;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;

            proxy_pass $backend5;
        }

        # ======================================================
        # APP 6
        # ======================================================
        set $frontend6 http://frontend6:8080;
        set $backend6  http://backend6:8000;

        location /daouda-ba-app/ {
            rewrite ^/daouda-ba-app/(.*)$ /$1 break;

            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;

            proxy_pass $frontend6;
        }

        location /daouda-ba-app/api/ {
            rewrite ^/daouda-ba-app/api/(.*)$ /$1 break;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;

            proxy_pass $backend6;
        }

        # ======================================================
        # APP 7
        # ======================================================
        set $frontend7 http://frontend7:8080;
        set $backend7  http://backend7:8000;

        location /ibrahim-diarrassouba-app/ {
            rewrite ^/ibrahim-diarrassouba-app/(.*)$ /$1 break;

            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;

            proxy_pass $frontend7;
        }

        location /ibrahim-diarrassouba-app/api/ {
            rewrite ^/ibrahim-diarrassouba-app/api/(.*)$ /$1 break;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;

            proxy_pass $backend7;
        }

        # ======================================================
        # APP 8
        # ======================================================
        set $frontend8 http://frontend8:8080;
        set $backend8  http://backend8:8000;

        location /kofivi-yena-app/ {
            rewrite ^/kofivi-yena-app/(.*)$ /$1 break;

            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;

            proxy_pass $frontend8;
        }

        location /kofivi-yena-app/api/ {
            rewrite ^/kofivi-yena-app/api/(.*)$ /$1 break;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;

            proxy_pass $backend8;
        }

        # ======================================================
        # APP 9
        # ======================================================
        set $frontend9 http://frontend9:8080;
        set $backend9  http://backend9:8000;

        location /kokou-elolo-app/ {
            rewrite ^/kokou-elolo-app/(.*)$ /$1 break;

            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;

            proxy_pass $frontend9;
        }

        location /kokou-elolo-app/api/ {
            rewrite ^/kokou-elolo-app/api/(.*)$ /$1 break;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;

            proxy_pass $backend9;
        }

        # ======================================================
        # APP 10
        # ======================================================
        set $frontend10 http://frontend10:8080;
        set $backend10  http://backend10:8000;

        location /laurent-minakpon-app/ {
            rewrite ^/laurent-minakpon-app/(.*)$ /$1 break;

            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;

            proxy_pass $frontend10;
        }

        location /laurent-minakpon-app/api/ {
            rewrite ^/laurent-minakpon-app/api/(.*)$ /$1 break;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;

            proxy_pass $backend10;
        }

        # ======================================================
        # APP 11
        # ======================================================
        set $frontend11 http://frontend11:8080;
        set $backend11  http://backend11:8000;

        location /mohamed-sall-app/ {
            rewrite ^/mohamed-sall-app/(.*)$ /$1 break;

            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;

            proxy_pass $frontend10;
        }

        location /mohamed-sall-app/api/ {
            rewrite ^/mohamed-sall-app/api/(.*)$ /$1 break;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;

            proxy_pass $backend10;
        }

        # ======================================================
        # APP 12
        # ======================================================
        set $frontend12 http://frontend12:8080;
        set $backend12  http://backend12:8000;

        location /nancy-dobe-app/ {
            rewrite ^/nancy-dobe-app/(.*)$ /$1 break;

            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;

            proxy_pass $frontend10;
        }

        location /nancy-dobe-app/api/ {
            rewrite ^/nancy-dobe-app/api/(.*)$ /$1 break;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;

            proxy_pass $backend10;
        }

        # ======================================================
        # APP 13
        # ======================================================
        set $frontend13 http://frontend13:8080;
        set $backend13  http://backend13:8000;

        location /osseni-sossou-app/ {
            rewrite ^/osseni-sossou-app/(.*)$ /$1 break;

            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;

            proxy_pass $frontend10;
        }

        location /osseni-sossou-app/api/ {
            rewrite ^/osseni-sossou-app/api/(.*)$ /$1 break;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;

            proxy_pass $backend10;
        }

        # ======================================================
        # APP 14
        # ======================================================
        set $frontend14 http://frontend14:8080;
        set $backend14  http://backend14:8000;

        location /veh-minque-eddy-app/ {
            rewrite ^/veh-minque-eddy-app/(.*)$ /$1 break;

            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;

            proxy_pass $frontend10;
        }

        location /veh-minque-eddy-app/api/ {
            rewrite ^/veh-minque-eddy-app/api/(.*)$ /$1 break;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;

            proxy_pass $backend10;
        }

        # ======================================================
        # ERROR PAGES
        # ======================================================
        error_page 502 503 504 404 /unavailable.html;

        location = /unavailable.html {
            root /etc/nginx/html;
        }
    }
}
