events {}

http {
    resolver 127.0.0.11 ipv6=off;

    server {
        listen 80;

        # ======================================================
        # DEFAULT LANDING PAGE
        # ======================================================
        location = / {
            root /usr/share/nginx/html;
            index index.html;
        }

        # ======================================================
        # APP 1 â€” Streamlit + FastAPI
        # ======================================================
        set $frontend1 http://frontend1:8080;
        set $backend1  http://backend1:8000;

        location /app1/ {
            rewrite ^/app1/(.*)$ /$1 break;

            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;

            proxy_pass $frontend1;
        }

        location /app1/api/ {
            rewrite ^/app1/api/(.*)$ /$1 break;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;

            proxy_pass $backend1;
        }

        # ======================================================
        # APP 2
        # ======================================================
        set $frontend2 http://frontend2:8080;
        set $backend2  http://backend2:8000;

        location /app2/ {
            rewrite ^/app2/(.*)$ /$1 break;

            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;

            proxy_pass $frontend2;
        }

        location /app2/api/ {
            proxy_pass $backend2/;
        }

        # ======================================================
        # APP 3
        # ======================================================
        set $frontend3 http://frontend3:8080;
        set $backend3  http://backend3:8000;

        location /app3/ {
            rewrite ^/app3/(.*)$ /$1 break;

            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;

            proxy_pass $frontend3;
        }

        location /app3/api/ {
            proxy_pass $backend3/;
        }

        # ======================================================
        # APP 4
        # ======================================================
        set $frontend4 http://frontend4:8080;
        set $backend4  http://backend4:8000;

        location /app4/ {
            rewrite ^/app4/(.*)$ /$1 break;

            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;

            proxy_pass $frontend4;
        }

        location /app4/api/ {
            proxy_pass $backend4/;
        }

        # ======================================================
        # APP 5
        # ======================================================
        set $frontend5 http://frontend5:8080;
        set $backend5  http://backend5:8000;

        location /app5/ {
            rewrite ^/app5/(.*)$ /$1 break;

            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;

            proxy_pass $frontend5;
        }

        location /app5/api/ {
            proxy_pass $backend5/;
        }

        # ======================================================
        # APP 6
        # ======================================================
        set $frontend6 http://frontend6:8080;
        set $backend6  http://backend6:8000;

        location /app6/ {
            rewrite ^/app6/(.*)$ /$1 break;

            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;

            proxy_pass $frontend6;
        }

        location /app6/api/ {
            proxy_pass $backend6/;
        }

        # ======================================================
        # APP 7
        # ======================================================
        set $frontend7 http://frontend7:8080;
        set $backend7  http://backend7:8000;

        location /app7/ {
            rewrite ^/app7/(.*)$ /$1 break;

            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;

            proxy_pass $frontend7;
        }

        location /app7/api/ {
            proxy_pass $backend7/;
        }

        # ======================================================
        # APP 8
        # ======================================================
        set $frontend8 http://frontend8:8080;
        set $backend8  http://backend8:8000;

        location /app8/ {
            rewrite ^/app8/(.*)$ /$1 break;

            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;

            proxy_pass $frontend8;
        }

        location /app8/api/ {
            proxy_pass $backend8/;
        }

        # ======================================================
        # APP 9
        # ======================================================
        set $frontend9 http://frontend9:8080;
        set $backend9  http://backend9:8000;

        location /app9/ {
            rewrite ^/app9/(.*)$ /$1 break;

            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;

            proxy_pass $frontend9;
        }

        location /app9/api/ {
            proxy_pass $backend9/;
        }

        # ======================================================
        # APP 10
        # ======================================================
        set $frontend10 http://frontend10:8080;
        set $backend10  http://backend10:8000;

        location /app10/ {
            rewrite ^/app10/(.*)$ /$1 break;

            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;

            proxy_pass $frontend10;
        }

        location /app10/api/ {
            proxy_pass $backend10/;
        }

        # ======================================================
        # ERROR PAGES
        # ======================================================
        error_page 502 503 504 404 /unavailable.html;

        location = /unavailable.html {
            root /usr/share/nginx/html;
        }
    }
}
